/*! kkr-pym.js - v1.0.0 - 2015-05-12 */
!function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.pym=a.call(this)}(function(){function a(a){return parseInt(a,10)}function b(a,b){var c;return function(){var d=this,e=arguments;m.clearTimeout(c),c=m.setTimeout(function(){a.apply(d,e)},b)}}function c(a,b,c){return p?m.attachEvent("on"+a,b):m.addEventListener(a,b,c)}function d(b){var c,d,e,f,g,h=n.body,i=n.defaultView,j=n.documentElement,k=n.createElement("div");return k.style.paddingLeft=k.style.width="1px",h.appendChild(k),g=2===a(k.offsetWidth),h.removeChild(k),k=b.getBoundingClientRect(),c=j.clientTop||h.clientTop||0,d=j.clientLeft||h.clientLeft||0,e=i.pageYOffset||g&&j.scrollTop||h.scrollTop,f=i.pageXOffset||g&&j.scrollLeft||h.scrollLeft,{client:{top:a(c),left:a(d)},scroll:{top:a(e),left:a(f)},offset:{top:a(k.top+e-c),left:a(k.left+f-d)}}}function e(){return o.offsetHeight}function f(){function a(){var a=e(),b=j.length,c=0;if(b&&h!==a)for(h=a;b>c;c+=1)j[c].sendHeight()}function f(){var a,b=i.length,c=0;if(b)for(;b>c;c+=1)a=i[c],a.sendMessage("position",d.encode(d(a.iframe)))}var g,h=null;g=b(f,32),c("resize",g),c("scroll",g),setInterval(a,32)}var g="xPYMx",h={kkr:{}},i=[],j=[],k="kkr-iframe",l="data-kkr-iframe-pos",m=window,n=document,o=n.getElementsByTagName("body")[0],p=!!m.attachEvent;d.encode=function(a){return[a.client.top||0,a.client.left||0,a.scroll.top||0,a.scroll.left||0,a.offset.top||0,a.offset.left||0].join(".")},d.decode=function(b){var c=b.split(".");return{client:{top:a(c[0]),left:a(c[1])},scroll:{top:a(c[2]),left:a(c[3])},offset:{top:a(c[4]),left:a(c[5])}}};var q=function(a){var b=new RegExp("[\\?&]"+a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},r=function(a,b){return"*"===b.xdomain||a.origin.match(new RegExp(b.xdomain+"$"))?!0:void 0},s=function(a,b,c){var d=["pym",a,b,c];return d.join(g)},t=function(a){var b=["pym",a,"(\\S+)","(.+)"];return new RegExp("^"+b.join(g)+"$")},u=function(){for(var a,b=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),c=[],d=b.length,e=0;d>e;++e){var f=b[e];f.setAttribute("data-pym-auto-initialized",""),""===f.id&&(f.id="pym-"+e);var g=f.getAttribute("data-pym-src"),i=f.getAttribute("data-pym-xdomain"),j={};i&&(j.xdomain=i),a=new h.Parent(f.id,g,j),c.push(a),c[f.id]=a}c.length&&(h.autoloaded=c)};return h.kkr.genParent=function(a,b){return h.Parent(k,a,b)},h.kkr.genChild=function(a){return a||(a={}),a.id=k,new h.Child(a)},h.kkr.getIframePosDataAttrName=function(){return l},h.kkr.getIframePosData=function(){var a=o.getAttribute(l);return a?d.decode(a):null},h.kkr.getModalOffset=function(){try{var b=h.kkr.getIframePosData();if(b.offset.top<b.scroll.top&&(b=a(b.scroll.top-b.offset.top),!isNaN(b)))return b}catch(c){}return 0},h.Parent=function(a,b,d){this.id=a,this.url=b,this.el=document.getElementById(a),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=t(this.id),this.messageHandlers={},d=d||{},this._constructIframe=function(){var a=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var b="",d=this.url.indexOf("#");d>-1&&(b=this.url.substring(d,this.url.length),this.url=this.url.substring(0,d)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+a+"&childId="+this.id+b,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.el.appendChild(this.iframe);var e=this;c("resize",function(){e.sendWidth()})},this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)},this._processMessage=function(a){if(r(a,this.settings)){var b=a.data.match(this.messageRegex);if(!b||3!==b.length)return!1;var c=b[1],d=b[2];this._fire(c,d)}},this._onHeightMessage=function(a){var b=parseInt(a);this.iframe.setAttribute("height",b+"px")},this._onNavigateToMessage=function(a){document.location.href=a},this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this.sendMessage=function(a,b){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(s(this.id,a,b),"*")},this.sendWidth=function(){var a=this.el.offsetWidth.toString();this.sendMessage("width",a)};for(var e in d)this.settings[e]=d[e];this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage);var f=this;return c("message",function(a){f._processMessage(a)},!1),this._constructIframe(),i.push(this),this},h.Child=function(a){this.parentWidth=null,this.id=null||a.id,this.settings={renderCallback:null,xdomain:"*",polling:0},this.messageRegex=null,this.messageHandlers={},a=a||{},this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)},this._processMessage=function(a){if(r(a,this.settings)){var b=a.data.match(this.messageRegex);if(b&&3===b.length){var c=b[1],d=b[2];this._fire(c,d)}}},this._onWidthMessage=function(a){var b=parseInt(a);b!==this.parentWidth&&(this.parentWidth=b,this.settings.renderCallback&&this.settings.renderCallback(b),this.sendHeight())},this.sendMessage=function(a,b){window.parent.postMessage(s(this.id,a,b),"*")},this.sendHeight=function(){var a=document.getElementsByTagName("body")[0].offsetHeight.toString();e.sendMessage("height",a)},this.scrollParentTo=function(a){this.sendMessage("navigateTo","#"+a)},this.navigateParentTo=function(a){this.sendMessage("navigateTo",a)},this.id=q("childId")||a.id,this.messageRegex=new RegExp("^pym"+g+this.id+g+"(\\S+)"+g+"(.+)$");var b=parseInt(q("initialWidth"));this.onMessage("width",this._onWidthMessage);for(var d in a)this.settings[d]=a[d];var e=this;return c("message",function(a){e._processMessage(a)},!1),this.settings.renderCallback&&this.settings.renderCallback(b),this.sendHeight(),j.push(this),this.onMessage("position",function(a){o.setAttribute(l,a)}),this},u(),f(),h});